import express from 'express';
import bodyParser from 'body-parser';
import {Router, Request, Response} from express;
import {filterImageFromURL, deleteLocalFiles} from './util/util';

(async () => {

  // Init the Express application
  const app = express();

  // Set the network port
  const port = process.env.PORT || 8082;
  
  // Use the body parser middleware for post requests
  app.use(bodyParser.json());

  // @TODO1 IMPLEMENT A RESTFUL ENDPOINT
  // GET /filteredimage?image_url={{URL}}
  // endpoint to filter an image from a public url.
  // IT SHOULD
  //    1
  //    1. validate the image_url query
  //    2. call filterImageFromURL(image_url) to filter the image
  //    3. send the resulting file in the response
  //    4. deletes any files on the server on finish of the response
  // QUERY PARAMATERS
  //    image_url: URL of a publicly accessible image
  // RETURNS
  //   the filtered image file [!!TIP res.sendFile(filteredpath); might be useful]

  /**************************************************************************** */

  //! END @TODO1
  
  // Root Endpoint
  // Displays a simple message to the user

app.get('/filteredimage', async(req: Request, res:Resonse)=>{
  const image_url= req.query.image_url.tostring();
  if(!image_url){
    res.status(400).send("image url is needed")
  }
  const filtered_image = await filteredImageFromURL(image_url);

  res.status(200).sendFile(filtered_image, () =>{
    deleteLocalFiles([filtered_image]);
  });


});

  /*app.get("/filteredimage?image_url={{URL}}",async(req,res)=>{
    console.log("in");
    let {image_url} = req.params.image_url;
    //url validation
    const isValideUrl = image_url.match(data:image/jpeg;base64,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);
    if(isValideUrl  ==  null)
      return res.status(400).send(`url not valid! Try again with a valid url`);
    else{
    //Process Image
      const filteredImage = filterImageFromURL(image_url);
      if(filteredImage===undefined||filteredImage===null)
      return res.status(400).send(`Unable to filter image`);
      else{
        res.on('finish', function() {
          deleteLocalFiles([filteredImage]);  
        });
        return res.status(200).sendFile(''+filteredImage);

      }
      
    }*/
  
  })
  app.get( "/", async ( req, res ) => {
    res.send("try GET /filteredimage?image_url={{}}")
  } );
  

  // Start the Server
  app.listen( port, (8082) => {
      console.log( `server running http://localhost:${ port }` );
      console.log( `press CTRL+C to stop server` );
  } );
})();